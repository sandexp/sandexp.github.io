#### 分区副本分配

生产者分区分配是给消息指定发送的位置，消费者分区分配是给消息指定消费的位置。

如果需要自己指定，则需要设置`replica-assignment`参数, 否则按照既定方式进行分配。

#### 优先副本

分区使用多副本机制提高可读性，其中leader副本用于提供服务，follower副本用于同步leader副本，在leader副本节点宕机的时候，根据选举策略选举一个新leader来提供服务。具体过程参考Raft论文中关于选举的论述。

那么为了保证每个broker分配的follower服务节点经历均衡，每个分区对leader副本所在机器的选择需要合理，才能达到负载均衡的效果。

Kafka提供了分区平衡的功能，启用这项功能的时候，会启动一个定时任务，这个任务不断地轮询各个broker节点，计算每个broker节点的分区不平衡度，根据这个参数来进行平衡操作。

#### 分区重分配

某个节点宕机的时候，为了保证Kafka集群的负载均衡，需要重新分配分区，这个过程称作分区的重分配。

分区重分配首先需要通过控制器添加新的副本，然后新的副本从leader副本同步数据，同步完毕之后将旧的副本删除即可。但是分区重分配会造成很大的网络开销，为了限制复制过程中的网络开销，必须要进行**复制限流**的操作。

