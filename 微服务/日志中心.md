日志主要用于记录系统、进程和应用运行时的信息，同时可以监控系统中发生的各种事件。

随着系统服务数量越来越多，对于一次业务调用，可能需要经过多个服务模块处理。在异常发生时，排查代码错误会变得非常困难，当前比较有效和认可的做法是为程序打印运行日志，将程序的关键路径、关键数据记录下来，以便日后排查问题时作为参考。

#### 日志类型

日志可以分为系统日志、容器日志和应用日志等。按照应用目标的不同，日志可以分为性能日志、安全日志等。按照级别的不同，日志可以分为调试日志、信息日志、警告日志和错误日志等。

1. 访问日志

   对于客户端的访问，我们期望能确认客户端的请求是否被服务端接收到，这种类型的日志称为访问日志.

   访问日志一般记录了客户端的请求资源或接口、请求耗时、响应结果（状态码）等，这些数据除了用来排查问题外，还可以用来统计服务的运行状况和性能表现，比如QPS、平均响应时间、错误率等。

2. 性能日志

   对提供的服务接口、依赖的接口、关键的程序路径等统计响应时间，打印到专用的性能日志中，用来监控和排查超时等性能问题。

3. 远程服务调用日志

   一个服务可能依赖于其他服务，通常使用RPC或者REST进行调用，在调用远程服务或被远程服务调用时，都需要打印出耗时日志，这能够帮助我们排查接口调用错误或者超时等问题。

4. 业务系统应用日志

   一般使用`Log4j、Slf4j、Logback、Log4j2`等，业务日志一般分为Trace、Debug、Warn、Info和Error级别等

   刚上线且不稳定的项目中通常设置为Debug级别，便于查找问题。在线上系统稳定后使用Error级别即可，这样能够有效地提高效率。

5. `GC`日志

   `GC`（Garbage Collection）是Java虚拟机中一个很重要的组成部分，在很多情况下我们都需要查看`GC`日志。

#### 日志框架

1. JDK Logger

2. Apache Commons Logging

   Apache Commons Logging（简称Commons Logging）只提供了日志接口，具体的实现则在运行时根据配置动态查找日志的实现框架。

   它的出现避免了和具体的日志实现框架直接耦合。在日常开发中，开发者可以选择第三方日志组件搭配使用，例如`Log4j`。

   > 传统的系统基本上使用Commons Logging和`Apache Log4j`的组合，`CommonsLogging`使用门面设计模式实现，门面后面可以转接`Apache Log4j`等其他日志实现框架。

3. `Log 4j/ Log 4j2`

   `Log4j`中有3个主要的组件，它们分别是Logger（记录器）、Appender（输出源）和Layout（布局），这3个组件可以简单地理解为日志类别、日志要输出的地方和日志以何种形式输出。

#### ELK技术栈简介

##### 简述

ELK项目是开源项目`Elasticsearch、Logstash`和`Kibana`的集合，集合中每个项目的职责如下。

1. `Elasticsearch`：一个基于`Lucene`搜索引擎的`NoSQL`数据库。
2. `Logstash`：一个基于管道的处理工具，它从不同的数据源接收数据，执行不同的转换，然后发送数据到不同的目标系统。
3. `Kibana`：工作在`Elasticsearch`上，是数据的展示层系统。

