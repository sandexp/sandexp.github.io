#### 动态代理介绍

动态代理是一种强大的功能，它可以在运行时动态创建一个类，实现一个或多个接口，可以在不修改原有类的基础上动态为通过该类获取的对象添加方法、修改行为。

动态代理是实现面向切面的编程AOP（Aspect Oriented Programming）的基础。切面的例子有日志、性能监控、权限检查、数据库事务等。

代理主要分为静态代理和动态代理，动态代理可以由`Java SDK`或者第三方库`cglib`提供.

#### 静态代理

代理背后一般至少有一个实际对象，代理的外部功能和实际对象一般是一样的，用户与代理打交道，不直接接触实际对象。代理用于隔离外部访问和内部对象。

主要存在如下的意义:

1. 节省成本比较高的实际对象的创建开销，按需延迟加载
2. 执行权限检查，代理检查权限后，再调用实际对象
3. 屏蔽网络差异和复杂性，代理在本地，而实际对象在其他服务器上，调用本地代理时，本地代理请求其他服务器。

#### 动态代理

##### 使用Java SDK实现动态代理

获取代理对象的过程

1. 通过`Proxy.getProxyClass`创建代理类定义，类定义会被缓存
2. 获取代理类的构造方法，构造方法有一个`InvocationHandler`类型的参数
3. 创建`InvocationHandler`对象，创建代理类对象

##### 使用`cglib`实现动态代理

Java SDK动态代理的局限在于，它只能为接口创建代理，返回的代理对象也只能转换到某个接口类型. 也就是说，如果是普通类的情况下，就不能使用Java SDK创建动态代理了。

这种情况下，可以使用`cglib`创建动态代理.

代理对象主要使用的是`cglib`的`Enhancer`类，`Enhancer`类支持多种类型。

`cglib` 的实现机制与Java SDK不同，它是通过继承实现的，它也是动态创建了一个类，但这个类的父类是被代理的类，代理类重写了父类的所有public非final方法，改为调用Callback中的相关方法。

##### 两种代理方式的区别

Java SDK代理面向的是一组接口，它为这些接口动态创建了一个实现类。，Java SDK代理的是对象，需要先有一个实际对象，自定义的`InvocationHandler`引用该对象，然后创建一个代理类和代理对象。Java SDK要求该类必须有接口，且只能处理接口中的方法。

`cglib`代理面向的是一个具体的类，它动态创建了一个新类，继承了该类，重写了其方法。`cglib`代理的是类，创建的对象只有一个, 且对类的类型没有特殊要求。