Java中提供文件映射内存的是Java的NIO包，通过从文件中获得一个通道（channel）

> 通道是用于磁盘文件的一种抽象，它使我们可以访问诸如内存映射、文件加锁机制以及文件间快速数据传递等操作系统特性。

可以从文件通道的map中获取一个对应的缓冲区，用作文件映射内存，文件映射内存主要包含如下三种模式:

1. `FileChannel.MapMode.READ_ONLY`：所产生的缓冲区是只读的
2. `FileChannel.MapMode.READ_WRITE`：所产生的缓冲区是可写的，任何修改都会在某个时刻写回到文件中。写入的结果对于不同线程来说是不可见的，只有真正写入到磁盘时候，状态才可以见。
3. `FileChannel.MapMode.PRIVATE`：所产生的缓冲区是可写的，但是任何修改对这个缓冲区来说都是私有的，不会传播到文件中。也就是说每个线程维护一个副本。

#### 缓冲区

也就是NIO的缓冲区，比较常用的就是`ByteBuffer`, NIO的`ByteBuffer`使用一个指针控制读写, 使用flip函数控制读取范围，但是无法自动扩容，这是相对于Netty的缺陷。

#### 文件加锁机制

考虑一下多个同时执行的程序需要修改同一个文件的情形，很明显，这些程序需要以某种方式进行通信，不然这个文件很容易被损坏。第一个实例应该锁定这个文件，当第二个实例发现这个文件被锁定时，它必须决策是等待直至这个文件解锁，还是直接跳过这个写操作过程。

例如，可以使用`FileChannel`的lock或者`tryLock`方法。

